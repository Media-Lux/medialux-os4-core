{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://os4.medialux/schemas/OS4_ATLAS_VAULT_LOGS/event.schema.json",
  "title": "OS4_ATLAS_VAULT_LOGS Event (JSONL Line, Canonical)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "event_id",
    "ts_utc",
    "category",
    "severity",
    "actor",
    "refs",
    "controls",
    "payload_hash",
    "prev_event_hash",
    "event_hash"
  ],
  "properties": {
    "event_id": {
      "type": "string",
      "pattern": "^EVT-[0-9]{4}-[0-9]{2}-[0-9]{2}-[0-9]{6}$"
    },
    "ts_utc": { "type": "string", "format": "date-time" },

    "category": {
      "type": "string",
      "enum": ["TRADE", "RISK", "GOV", "APPROVAL", "INCIDENT", "HEALTH"]
    },
    "severity": { "type": "string", "enum": ["INFO", "WARN", "CRIT"] },

    "actor": {
      "type": "object",
      "additionalProperties": false,
      "required": ["role", "corepass_did_hash"],
      "properties": {
        "role": {
          "type": "string",
          "enum": ["OPERATOR", "VALIDATOR", "AUDITOR", "SYSTEM", "HUMAN_CONSENT"]
        },
        "corepass_did_hash": {
          "type": "string",
          "pattern": "^0x[0-9a-f]{64}$"
        }
      }
    },

    "refs": {
      "type": "object",
      "additionalProperties": false,
      "required": ["strategy", "venue"],
      "properties": {
        "strategy": { "type": "string", "enum": ["STABLE_CASHFLOW", "BASIS_ENGINE"] },
        "venue": { "type": "string", "minLength": 2, "maxLength": 32 },

        "instrument": { "type": "string", "maxLength": 64 },
        "asset": { "type": "string", "maxLength": 16 },

        "order_id": { "type": "string", "maxLength": 128 },
        "position_id": { "type": "string", "maxLength": 128 }
      }
    },

    "controls": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "policy_id",
        "policy_version",
        "policy_hash",
        "leverage_cap",
        "cash_reserve_min",
        "depeg_guard",
        "funding_divergence_guard"
      ],
      "properties": {
        "policy_id": { "type": "string", "minLength": 3, "maxLength": 64 },
        "policy_version": { "type": "string", "minLength": 1, "maxLength": 32 },
        "policy_hash": { "type": "string", "pattern": "^0x[0-9a-f]{64}$" },

        "leverage_cap": { "type": "string", "pattern": "^[0-9]+(\\.[0-9]+)?$" },
        "cash_reserve_min": { "type": "string", "pattern": "^[0-9]+(\\.[0-9]+)?$" },

        "depeg_guard": { "type": "boolean" },
        "funding_divergence_guard": { "type": "boolean" }
      }
    },

    "payload_hash": { "type": "string", "pattern": "^0x[0-9a-f]{64}$" },
    "prev_event_hash": { "type": "string", "pattern": "^0x[0-9a-f]{64}$" },
    "event_hash": { "type": "string", "pattern": "^0x[0-9a-f]{64}$" }
  }
}
